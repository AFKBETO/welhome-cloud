<div class="property-component">
  <div *ngIf="!this.propertyData">
    <div class="spinner-border" role="status"></div>
  </div>
  <div class="main-div" *ngIf="!!this.propertyData">
    <div class="photos">
      <div>
        <img src="{{ this.images[this.currentImageIndex] }}" alt="Property image" class="main-photo">
      </div>
      <div class="maisons">
        <img *ngFor="let image of this.images; let i = index"
            [src]="image"
            [alt]="'Maison ' + (i+1)"
            class="small-photo"
            (click)="this.currentImageIndex = i">
      </div>
      <button id="next-btn" (click)="nextImage()">Next image</button>
    </div>

    <div class="left-div">
      <div class="infos">
        <h1> {{this.propertyData.title}}</h1>
        <p> <strong> Description : </strong>{{ this.propertyData.description }}</p>
        <p><strong> Location : </strong>{{ this.propertyData.city}}, {{ this.propertyData.country}} </p>
        <p> <strong> Area : </strong>{{ this.propertyData.surface_area}}</p>
        <p> <strong> Floors : </strong>{{ this.propertyData.floors}}</p>
        <p> <strong> {{ this.propertyData.property_category }} capacity : </strong>{{ this.propertyData.capacity}}</p>
      </div>

      <div class="reservation-container" *ngIf="!this.isOwner && this.isRenterContext">
        <h1> Réserver</h1>
        <div class="row form-container">
          <div class="price col-lg-6">
            <span class="price-value">{{ this.propertyData.price }} €</span> per night
          </div>
          <form class="col-lg-6" [formGroup]="this.reservationGroup">
            <mat-form-field appearance="fill">
              <mat-label>Enter a date range</mat-label>
              <mat-date-range-input [rangePicker]="picker">
                <input matStartDate placeholder="Start date" required formControlName="start_date">
                <input matEndDate placeholder="End date" required formControlName="end_date">
              </mat-date-range-input>
              <mat-error *ngIf="this.dateRequiredError">
                Date is required
              </mat-error>
              <mat-error *ngIf="this.dateMinimumError">
                Date must be after today
              </mat-error>
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
          </form>
        </div>


        <div class="btn-container" *ngIf="this.userIsLoggedIn;">
          <div class="btn-container">
            <button id="reservation-btn" (click)="this.reserveProperty()" [disabled]="!this.reservationGroup.valid">Reserve</button>
          </div>
        </div>
        <div class="btn-container" *ngIf="!this.userIsLoggedIn;">
          <button id="reservation-btn" (click)="this.promptLogin()">Login to reserve</button>
        </div>
        <div class="total-container">
          <h4>Total ({{ this.days }} day{{ this.days > 1 ? 's' : '' }})</h4>
          <span>{{this.totalPrice}} €</span>
        </div>
      </div>
      <div *ngIf="reviewData && reviewData.length" class="reviews-container">
        <h1 class="reviews-title">Reviews</h1>
        <hr class="title-underline">
        <!-- Boucle pour parcourir chaque review -->
        <div *ngFor="let review of reviewData" class="review">
          <div class="review-header">
            <span class="review-author">{{review.reviewer_email}}</span>
            <span class="review-date">{{review.published_date}}</span>
    
            <!-- Boucle pour afficher le nombre d'étoiles correspondant à la note -->
            <div class="review-rating">
              <i *ngFor="let star of getRatingStars(review.rating)" [class]="star"></i>
            </div>
    
          </div>
          <span class="review-text">{{review.review_text}}</span>
    
        </div>
      </div>
    </div>
  </div>
  
</div>

